%% Copyright 2019 Bernd Haberstumpf
%% License: CC BY-NC

\RequirePackage{fancyhdr}               % Header/Footer
\RequirePackage[newparttoc]{titlesec}	% Chapter & Section formatting

%
% Document layout
%

\newcommand{\preamble}{
    %\frontmatter
    \pagestyle{empty}
}

\newcommand{\content}{
    %\mainmatter
    \pagestyle{plain}
}


%
% Page layout
%

\parskip1.0ex
\parindent0.0ex

\geometry{a4paper,
    includeheadfoot,
    top=5mm,
    headheight=30mm,
    headsep=10mm,
    footskip=30mm,
    bottom=7mm,
    left=20mm,
    right=25mm,
    rmargin=325mm
}


%
% Header/Footer
%

\renewcommand{\headrulewidth}{0.0pt} %no rule for header
\renewcommand{\footrulewidth}{0.0pt} %no rule for footer

\renewcommand{\chaptername}{} % Remove the header name prefix

\fancypagestyle{plain}{
    \fancyhf{} % clear all headers and footers
    
    \fancyhead{
        \begin{tikzpicture}[remember picture,overlay]
            \node[inner sep=0pt,anchor=north west] at (current page.north west)
            {\includegraphics[width=\paperwidth]{lib/images/header-page}};
        \end{tikzpicture}
        \newgeometry{top=5cm}
    }

    \fancyfoot[LE]{
       \begin{tikzpicture}[remember picture,overlay]
            \node[xscale=-1,inner sep=0pt,anchor=south,nearly opaque] at (current page.south) {\includegraphics[width=\paperwidth,height=21pt]{lib/images/footer-page-left}};
            \node[xshift=20pt,yshift=12pt] at (current page.south west) {\@fontPgNumFoot\textcolor{colFoot}{\thepage}};
            \node[anchor=south west,xshift=\marginparwidth+\marginparpush-30pt,yshift=2pt] at (current page.south west) {\@fontFoot{\textcolor{colFoot}{ %
                // \nouppercase\leftmark%
                \ifthenelse{\isempty{\@sectionname}}{}{.\@sectionname}%
                // }}
            };
        \end{tikzpicture}
    }

    \fancyfoot[RO]{
        \begin{tikzpicture}[remember picture,overlay]
            \node[inner sep=0pt,anchor=south,nearly opaque] at (current page.south)
            {\includegraphics[width=\paperwidth,height=21pt]{lib/images/footer-page-right}};
            \node[xshift=-20pt,yshift=12pt] at (current page.south east) {\@fontPgNumFoot\textcolor{colFoot}{\thepage}};
            \node[anchor=south east,xshift=-\marginparwidth-\marginparpush+30pt,yshift=2pt] at (current page.south east) {\@fontFoot{\textcolor{colFoot}{ %
                // \nouppercase\leftmark%
                \ifthenelse{\isempty{\@sectionname}}{}{.\@sectionname}%
                // }}
            };
        \end{tikzpicture}
    }
}

%
% Chapter and section layout
% 

% Chapter
\titleformat{\chapter}%block
{\vspace{-30pt}\color{colChapter}\@fontChapter}             % Chapter name
{}                                                          % Chapter number
{0cm}                                                       % Title sparation
{\Huge}                                                     % Pre Chapter name
[{\titleline{\color{colTitleRuler}\titlerule[2pt]}}]        % Ruler


% Section
\titleformat{\section}%[block]
{\color{colSection}\@fontSection\huge}
{}
{0.5em}
{}
[{\titleline{\color{colTitleRuler}\titlerule[0.5pt]}}]


% Subsection
\titleformat{\subsection}%[block]
{\color{colSubsection}\@fontSubsection\LARGE}
{}
{0.5em}
{}
[{\titleline{\color{colTitleRuler}\titlerule[0.5pt]}}]